# Service Mesh
#### Service Mesh : 
- 서비스 매쉬는 사용자가 작성한 코드와는 별개로 네크워크 기능을 하는 네트워크 커뮤니케이션 영역이다.즉 소프트웨어 계층이 아니라 인프라 측면에서 이를 풀기 위한 노력이 서비스 매쉬라는 아키텍쳐 컨셉이다. 

#### Service Mesh 특징 : 

![스크린샷 2019-03-11 오후 3.54.24.png](https://s3-ap-northeast-1.amazonaws.com/torchpad-production/wikis/10853/0GsNvyKTZSkiWADDQ1Bc_%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202019-03-11%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%203.54.24.png)
> 서비스와 서비스간의 호출이 있을때 직접 호출 하는 것이아니라 proxy를 통해 호출한다.이렇게 하면 서비스로 들어오거나 나가는 트래픽을 네트워크 단에서 모두 통제가 가능하게 되고, 트래픽에 대한 통제를 통해서 마이크로 서비스의 여러가지 문제를 해결할 수 있다. 

![스크린샷 2019-03-11 오후 3.56.25.png](https://s3-ap-northeast-1.amazonaws.com/torchpad-production/wikis/10853/i7Ipmg13TaeOCH62XO0j_%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202019-03-11%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%203.56.25.png)
> 서비스가 클라이언트 OS에 따라서 다른 서비스를 호출해야 한다면, 서비스가 다른 서비스를 호출할때, 프록시에서 메세지의 헤더를 보고 “Client”라는 필드가 Android면, 안드로이드 서비스로 라우팅을 하고, “IOS”면 IOS 서비스로 라우팅 하는 지능형 라우팅 서비스를 할 수 있다. 이런 다양한 기능을 수행하기 위해서는 기존의 HA Proxy,nginx, Apache 처럼 TCP 기반의 프록시로는 한계가 있다. 예를 들어서 위에서 언급한 HTTP 헤더 기반의 라우팅이나 조금더 나가면 메세지 본문을 기반으로 하는 라우팅들이 필요하기 때문에, L7 계층의 지능형 라우팅이 필요하다.

#### Service Mesh 문제점 :
마이크로 서비스는 한두개의 서비스가 아니라 수백, 수천의 서비스로 구성된다. 프록시를 사용해서 여러 기능을 구성할 수 있지만 문제는 서비스 수에 따라 프록시 수도 증가하기 때문에, 이 프록시에 대한 설정을 하기가 어려워진다는 것이다. 

![스크린샷 2019-03-11 오후 4.00.15.png](https://s3-ap-northeast-1.amazonaws.com/torchpad-production/wikis/10853/hv0M4ro2QwvMknOMgVUg_%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202019-03-11%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%204.00.15.png)

#### Service Mesh 해결점 :
 이런 문제를 해결하기 위해서, 각 프록시에 대한 설정 정보를 중앙 집중화된 컨트롤러가 통제하는 구조를 취할 수 있다. 아래 구조와 같이 되는데, 각 프록시들로 이루어져서 트래픽을 설정값에 따라 트래픽을 컨트롤 하는 부분을 데이타 플레인(Data Plane)이라고 하고, 데이타 플레인의 프록시 설정값들을 저장하고, 프록시들에 설정값을 전달하는 컨트롤러 역할을 하는 부분을 컨트롤 플레인(Control Plane) 이라고 한다. 
![스크린샷 2019-03-11 오후 4.02.22.png](https://s3-ap-northeast-1.amazonaws.com/torchpad-production/wikis/10853/qSqClMogQXK03att3OnM_%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202019-03-11%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%204.02.22.png)
 
* 참고 : 조대협 블로그 ( https://bcho.tistory.com/1293 )
