# Kubernetes_Service

### Service

- 동적으로 변하는 포드들에 고정된 방법으로 접근하기 위해서 사용하는 오브젝트이다. 포드는 컨트롤러에 의해 관리되기 때문에 한군데에 고정되서 떠 있지 않고, 클러스터내를 옮겨다니게 된다. 이 과정에서 노드를 옮기면서 실행되기도 하고 클러스터내의 포드 IP가 변경되기도 때문에 고정된 방법으로 접근하는 것이 service이다.
   - 포드가 클러스터내의 어디에 있는지에 상관없이 고정된 주소를 이용해서 접근이 가능
   - 클러스터 외부에서 포드에 접근하는것도 서비스를 통해서 가능
   
![스크린샷 2019-01-16 오후 2.05.54.png](https://s3-ap-northeast-1.amazonaws.com/torchpad-production/wikis/10853/252j94obTYSg3a63hdUC_%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202019-01-16%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.05.54.png)
![스크린샷 2019-01-16 오후 2.06.01.png](https://s3-ap-northeast-1.amazonaws.com/torchpad-production/wikis/10853/fxCLVgeGQHuecIzEuESG_%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202019-01-16%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.06.01.png)
 > 포드가 옮겨 갔을때 서비스가 자동으로 새로 뜬 포드를 바라보기 때문에 실제 접속하는 사용자는 서비스만 바라보고 있으면 문제없이 새로운 포드를 사용할 수 있다.
 
 * service 종류
 
 - ClusterIP : 기본 서비스 타입이고 쿠버네티스 클러스터 내부에서 사용가능하다. 클러스터 내부의 노드나 포드에서 이 ClusterIP를 이용해서 이 서비스에 연결된 포드에 접속 가능하다. 클러스터 외부에서는 이용할 수 없다.
 
 - NodePort : 각 노드의 지정된 포트를 할당하는 방식이다. node1:8080, node2:8080 이런방식으로 노드에 상관없이 포트번호만 서비스에 지정된걸 사용하면 접근이 가능하다. 노드의 포트를 사용하기 때문에 클러스터 내부 뿐만 아니라 클러스터 외부에서도 접근이 가능하다. 특이한 점은 포드가 node1에만 떠 있고 node2에는 없다고 하더라도 node2:8080으로 접근하면 node1에 떠 있는 포드로 연결이 가능하다. 클러스터외부에서 클러스터내부의 포드로 접근할때 사용할 수 있는 가장 간단한 방법이다.
 
 - LoadBalancer : 클라우드 서비스를 사용할때 사용가능한 옵션이다. 포드를 클라우드에서 제공해주는 로드밸런서와 연결해서 그 로드밸런서의 IP를 이용해서 클러스터 외부에서 접근이 가능하게 해준다. kubectl get service로 서비스를 확인해 봤을때 EXTERNAL-IP 부분에 로드밸런서 IP가 표시되고 이 IP를 사용하면 외부에서 접근이 가능하다.

 - ExternalName : 서비스를 externalName의 값이랑 매치한다. 클러스터 내부에서 외부로 접근할때 주로 사용. 이 서비스로 접근하면 설정해둔 CNAME값으로 연결되서 클러스터 외부로 접근할 수 있다. 외부로 접근할때 사용하는 값이기 때문에 설정할때 셀렉터가 필요 없다.
 
![스크린샷 2019-01-16 오후 2.27.24.png](https://s3-ap-northeast-1.amazonaws.com/torchpad-production/wikis/10853/cGtCrYbZQeSouPkNT3Jk_%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202019-01-16%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.27.24.png)
 
